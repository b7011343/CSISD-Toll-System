@page "/"
@using Microsoft.AspNetCore.Identity
@using CSISD_Tolling_System.Data
@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor httpContextAccessor
@inject ApplicationDbContext db

<AuthorizeView Roles="road-user">
    <Authorized>
        <div class="container">
            <h7 class="mb-5 font-weight-bold">Customer ID: @customerId</h7>
            <table class="table table-hover table-bordered mt-1 table-sm">
                <thead>
                    <tr>
                        <th class="text-center" colspan="5">Toll History</th>
                    </tr>
                    <tr>
                        <th scope="col">Date</th>
                        <th scope="col">Entry</th>
                        <th scope="col">Exit</th>
                        <th scope="col">Charge</th>
                        <th scope="col">Paid</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </Authorized>
</AuthorizeView>

<AuthorizeView Roles="toll-operator">
    <Authorized>

    </Authorized>
</AuthorizeView>

<AuthorizeView>
    <NotAuthorized>
        <section class="jumbotron text-center">
            <div class="container">
                <h1 class="jumbotron-heading">Welcome to the <b>Nordic Tolling Service</b></h1>
                <p class="lead text-muted">
                    Register or login to make use of this system...
                </p>
                <p>
                    <a href="/Identity/Account/Register" class="btn btn-primary my-2">Register</a>
                    <a href="/Identity/Account/Login" class="btn btn-secondary my-2">Login</a>
                </p>
            </div>
        </section>
    </NotAuthorized>
</AuthorizeView>

@code {
    private string customerId;
    
    protected override void OnInitialized()
    {
        string userName = httpContextAccessor.HttpContext.User.Identity.Name;
        if (userName != null)
        {
            customerId = db.Users.Where(x => x.Email == userName).FirstOrDefault().Id;
        }
    }
}
